(function(a){"use strict";var b,f;a.fn.isExternal=function(){var b=window.location.hostname,c=a("<a>",{href:this.attr("href")})[0].hostname;return c!==b};function e(){a(".close-modal").focus();var b=document.querySelectorAll('.wp-post-modal a[href]:not([disabled]), .wp-post-modal button:not([disabled]), .wp-post-modal textarea:not([disabled]), .wp-post-modal input[type="text"]:not([disabled]), .wp-post-modal input[type="radio"]:not([disabled]), .wp-post-modal input[type="checkbox"]:not([disabled]), .wp-post-modal select:not([disabled])'),c=b[0],d=b[b.length-1];document.addEventListener("keydown",function(a){var b=a.key==="Tab"||a.keyCode===9;if(!b)return;a.shiftKey&&b?document.activeElement===c&&(d.focus(),a.preventDefault()):b&&document.activeElement===d&&(c.focus(),a.preventDefault())})}function c(){return a(".modal-wrapper").hasClass("show")}function d(d,b){var a=d,c=a.charAt(a.length-1);return(c==="/"||c==="\\")&&(a=a.slice(0,-1)),a=a.replace(/^.*[/\\]/g,""),typeof b=="string"&&a.substr(a.length-b.length)===b&&(a=a.substr(0,a.length-b.length)),a}f=function(d){var e=decodeURIComponent(window.location.search.substring(1)),c=e.split("&"),a,b;for(b=0;b<c.length;b++)if(a=c[b].split("="),a[0]===d)return a[1]===void 0||a[1]};function g(){if(typeof wp.customize!="undefined"){var b=a("body");b.off("click.preview"),b.on("click.preview",`a[href]:not(.${fromPHP.modalLinkClass})`,function(b){var c=a(this);b.preventDefault(),wp.customize.preview.send("scroll",0),wp.customize.preview.send("url",c.prop("href"))})}}a(function(){var m=a(window),k=a(document),i,h=window.location.pathname,l=!!window.MSInputMethodContext&&!!document.documentMode;function j(b,c){i=window.pageYOffset,fromPHP.disableScrolling&&a("body, html").addClass("no-scroll"),a(".modal-wrapper").addClass("show"),a(".wp-post-modal").addClass("show"),setTimeout(function(){e()},1e3),b&&b.length>0&&!c&&history.replaceState("","",b)}function g(c){var d=a("body");d.hasClass("no-scroll")&&(d.removeClass("no-scroll"),a("html").removeClass("no-scroll"),window.scroll(0,i)),a(".modal-wrapper").removeClass("show").hide(),a(".wp-post-modal").removeClass("show"),a("#modal-content").empty(),b&&b.focus(),window.location.pathname!==c&&history.replaceState("","",c)}k.keyup(function(b){b.keyCode===27&&a(".modal-wrapper").hasClass("show")&&c()&&g(h)}).on("click",function(a){if(c()){const b=a.target instanceof HTMLAnchorElement||a.target.parentNode.className.indexOf(fromPHP.modalLinkClass)>=0||a.originalEvent.path&&a.originalEvent.path[1].className===fromPHP.modalLinkClass;b||g(h)}}).on("click",".close-modal",function(){c()&&g(h)}).on("click",".wp-post-modal, .modal-content",function(a){a.stopPropagation()});function n(){if(m.width()>=fromPHP.breakpoint){var c=f(fromPHP.modalLinkClass);c&&(fromPHP.loader&&a("#modal-content").html('<img class="loading" src="'+fromPHP.pluginUrl+'/images/loading.gif" />'),a.get(c,function(b){var c=b.indexOf("<html")>-1?a(b).find(fromPHP.containerID).html():b;a("#modal-content").html(c)}),a(".modal-wrapper").fadeIn("fast",j)),a("body").on("click",`.${fromPHP.modalLinkClass}`,function(l){var c=a("#modal-content"),f=a(this).attr("href")!==void 0?a(this):a(this).find("a").first(),e=f.attr("href"),i=e.lastIndexOf("/#")>-1?d(e.substring(0,e.lastIndexOf("/#")))+d(e):d(e),g=i.lastIndexOf("#")!==-1&&i.substring(i.lastIndexOf("#")),h=f.attr("data-div")?"#"+f.attr("data-div"):fromPHP.containerID,m=f.attr("data-buddypress"),n='<img class="loading" src="'+fromPHP.pluginUrl+'/images/loading.gif" />',k;b=document.activeElement,l.preventDefault(),fromPHP.loader&&c.html(n),f.isExternal()?a(this).hasClass("iframe")||fromPHP.iframe?(k='<iframe src="'+a(this).attr("href")+'" width="100%"'+' height="600px" frameborder="0"></iframe>',c.html(k)):(a.ajaxPrefilter(function(a){if(a.crossDomain&&jQuery.support.cors){var b=window.location.protocol==="http:"?"http:":"https:";a.url=b+"//cors-anywhere.herokuapp.com/"+a.url}}),a.get(e,function(b){c.html(a(b).find(h).html())})):m?c.load(e+" #buddypress"):a(this).hasClass("iframe")?(k='<iframe src="'+a(this).attr("href")+'" width="100%"'+' height="600px" frameborder="0"></iframe>',c.html(k)):fromPHP.restMethod||a(this).hasClass("rest")?a.get(fromPHP.siteUrl+"/wp-json/wp-post-modal/v1/any-post-type?slug="+i,function(b){a.when(c.html(b.post_content)).done(function(){setTimeout(function(){g&&a(".modal-wrapper").animate({scrollTop:a("#modal-content "+g).offset().top},300)},200)})}):a.get(e,function(b){var d=a(b).find(h),f=b.indexOf("<html")>-1?a(b).find(h).html():b;d[0]?a.when(c.html(f)).done(function(){setTimeout(function(){g&&a(".modal-wrapper").animate({scrollTop:a("#modal-content "+g).offset().top},300)},200)}):c.load(e,function(){c.html(a(c.html()).find(h).html()),setTimeout(function(){g&&a(".modal-wrapper").animate({scrollTop:a("#modal-content "+g).offset().top},300)},200)})}),a(".modal-wrapper").fadeIn("fast",function(){j(fromPHP.urlState?e:"",f.isExternal())})})}}l||n()}),a(window).on("load",function(){fromPHP.customizing&&g()})})(jQuery)